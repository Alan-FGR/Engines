<meta charset="UTF-8">
<html>

<head>
    <title>some thing</title>

    <style>



        





        table {
            border-collapse: collapse;
        }

        td {
            padding: 0 0.2em;
        }

        tr.section_header {
            height: 3em;
            vertical-align: bottom;
            background: linear-gradient(to bottom, #fff, #ddd);
            cursor: pointer;
        }

        tr.section_header > td:nth-child(even) {
            background: linear-gradient(to bottom, #fff, #ccc);
        }

        tr.section_content:nth-child(odd) {
            background: linear-gradient(to right, #fff, #eee, #fff, #eee, #ddd, #fff);
        }

        tr.section_content > td > div {
            border: 2px solid transparent;
        }

        div.tooltip {
            position: relative;
            border: 2px dotted black !important;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 10em;
            background-color: #000;
            color: #fff;
            padding: 0.8em 0.4em;
            position: absolute;
            z-index: 1;
            top: 1em;
            left: 0;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
        }


        div.ntooltip {
            position: relative;
        }

        .ntooltip .ntooltiptext {
            visibility: hidden;
            width: 30em;
            background-color: #000;
            color: #fff;
            padding: 0.8em 0.4em;
            position: absolute;
            z-index: 1;
            top: 1em;
            right: 0;
        }

        .ntooltip:hover .ntooltiptext {
            visibility: visible;
        }

    

    

    

    

    

    

    

    

    

    

    

    </style>
</head>

<body>

    <h1>some</h1>
    <p>thing</p>

    <div id="table_data">Loading data... (requires javascript)</div>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>

        var colors = [ //TODO color lerper
        "f99",
        "fa9",
        "fb9",
        "fc9",
        "fd9",
        "fe9",
        "ff9",
        "ef9",
        "df9",
        "cf9",
        "bf9",
        "af9",
        "9f9"
        ];

        function colorFromWeight(weight) {
            return colors[parseInt(weight * (colors.length - 1))];
        }

        function glyphFromWeight(weight) {
            if (weight == 0) return "✗";
            else if (weight == 1) return "✔";
            return "⍻";
        }

        function newEntry(weight, text, tooltip) {
            return {
                weight: weight,
                text: text,
                tooltip: tooltip
            };
        }

        /* accepted formats:
        weight
        stars (★)
        weight:tooltip
        text:weight
        */

        function parseEntry(raw) {
            var elements = raw.split(":");
            //console.log("elements", elements);
            if (elements.length == 1) {
                var element = elements[0];
                var number = parseFloat(element);
                if (!isNaN(number)) return newEntry(number, glyphFromWeight(number));
                if (element[0] == "★") return newEntry((element.length-1)/4, element);
            }
            else if (elements.length == 2) {
                var elementA = elements[0];
                var elementB = elements[1];
                var numberInA = parseFloat(elementA);
                if (!isNaN(numberInA)) return newEntry(numberInA, glyphFromWeight(numberInA), elementB);
                var numberInB = parseFloat(elementB);
                if (!isNaN(numberInB)) return newEntry(numberInB, elementB);
            }
            if (elements[0] == "") return newEntry(0, "NO DATA");
            return newEntry(0, "ERROR!!!");
        }

        function parseLine(line) {
            console.log("rawLine", line);
            var rawEntries = line.split("|");
            var entries = [];
            for (var i = 1; i < rawEntries.length-1; i++) {
                entries.push(parseEntry(rawEntries[i]));
                //console.log("parsedEntry", parseEntry(rawEntries[i]));
            }
            return {
                lineHeader: rawEntries[0],
                lineNotes: rawEntries[rawEntries.length-1],
                lineEntries: entries
            }
        }
        
        function calcSectionHeader(rawHeader, parsedLines) {
            var headers = rawHeader.split("|");
            for (var i = 0; i < headers.length-2; i++) {
                var sum = 0;
                for (var j = 0; j < parsedLines.length; j++) {
                    //console.log("======================="+i+", "+j);
                    //console.log(parsedLines);
                    sum += parsedLines[j].lineEntries[i].weight;
                }
                headers[i + 1] += "<sup>" + sum + "</sup>&frasl;<sub>" + parsedLines.length + "</sub>";
                console.log(headers);
            }
            return headers;
        }

        function parseSection(section) {
            var rawLines = section.trim().split("\n");
            var lines = [];
            console.log("rawLines", rawLines);
            for (var i = 2; i < rawLines.length; i++) {
                lines.push(parseLine(rawLines[i]));
            }
            console.log("parsedLines", lines);
            return {
                sectionHeader: calcSectionHeader(rawLines[0], lines),
                sectionLines: lines
            }
        }

        $(document).ready(function () {
            $.get("https://raw.githubusercontent.com/Alan-FGR/Engines/master/table_data.md", function (data) {
                
                var sections = data.split("\n\n");


                var finalTable = "<table>";

                for (var i = 0; i < sections.length; ++i) {
                //for (var i = 0; i < 1; ++i) {

                    var sectionData = parseSection(sections[i]);

                    console.log(sectionData);
                    
                    finalTable += "<tr class=\"section_header\">";

                    for (var j = 0; j < sectionData.sectionHeader.length; j++) {
                        finalTable += "<td><div>" + sectionData.sectionHeader[j] + "</div></td>";
                    }

                    finalTable += "</tr>";


                    for (var k = 0; k < sectionData.sectionLines.length; k++) {
                        finalTable += "<tr class=\"section_content\">";
                        var line = sectionData.sectionLines[k];
                        finalTable += "<td><div>" + line.lineHeader + "</div></td>";

                        for (var l = 0; l < line.lineEntries.length; l++) {
                            var entry = line.lineEntries[l];
                            var classes = "";
                            if (entry.tooltip != undefined) classes += "tooltip ";
                            finalTable += "<td><div class=\""+classes+"\" style=\"background-color:#" + colorFromWeight(entry.weight) + "\">" + entry.text;
                            if (entry.tooltip != undefined) finalTable += "<span class=\"tooltiptext\">"+entry.tooltip+"</span>";
                            finalTable += "</div></td>";
                        }

                        var notes = "";

                        if (line.lineNotes != "") {
                            notes = "HOVER<span class=\"ntooltiptext\">" + line.lineNotes + "</span>";
                        }

                        finalTable += "<td><div class=\"ntooltip\">" + notes + "</div></td>";
                        finalTable += "</tr>";
                    }

                };
//
                finalTable += "</table>";
                $("#table_data").html(finalTable);
            });
        });

        $(document).on('click', ".section_header", function () {
            $(this).nextUntil('.section_header').find('div').slideToggle();
        });
    </script>

</body>
</html>
